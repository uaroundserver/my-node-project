<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json?v=4">
  <meta name="theme-color" content="#0f1b2d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="UAround">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-180.png">

  <!-- –°—Ç–∏–ª–∏ -->
  <link rel="stylesheet" href="/styles.css?v=4" />

  <!-- –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–ø–æ–¥–∫—Ä–∞—Å–∫–∏ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–∞ -->


  <title>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å | UAround</title>
</head>
<body>
  <main id="main-content">
    <div class="form-container">
      <h1>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É <span style="color:#1e90ff;">UAround.com</span></h1>
      <p>–ü—Ä–æ–π–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π.</p>

      <h1>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
      <form id="registerForm">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required />
        <select id="country" class="input" required>
          <option value="" disabled selected>üåç–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</option>
          <option value="–ü–æ–ª—å—à–∞">üáµüá± –ü–æ–ª—å—à–∞</option>
          <option value="–ì–µ—Ä–º–∞–Ω–∏—è">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</option>
          <option value="–ß–µ—Ö–∏—è">üá®üáø –ß–µ—Ö–∏—è</option>
          <option value="–ò—Ç–∞–ª–∏—è">üáÆüáπ –ò—Ç–∞–ª–∏—è</option>
          <option value="–ò—Å–ø–∞–Ω–∏—è">üá™üá∏ –ò—Å–ø–∞–Ω–∏—è</option>
          <option value="–§—Ä–∞–Ω—Ü–∏—è">üá´üá∑ –§—Ä–∞–Ω—Ü–∏—è</option>
          <option value="–†—É–º—ã–Ω–∏—è">üá∑üá¥ –†—É–º—ã–Ω–∏—è</option>
          <option value="Hungary">üá≠üá∫ Hungary</option>
          <option value="–°–ª–æ–≤–∞–∫–∏—è">üá∏üá∞ –°–ª–æ–≤–∞–∫–∏—è</option>
          <option value="–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã">üá≥üá± –ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã</option>
        </select>
        <button type="submit">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
      </form>

      <p id="error-message" style="color:red;display:none;"></p>
      <p>–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? <a href="login.html">–í–æ–π—Ç–∏</a></p>
    </div>
  </main>

  <script>
    const API_BASE = 'https://uaround.onrender.com';

    // –ï—Å–ª–∏ —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –Ω–∞ –≥–ª–∞–≤–Ω—É—é
    if (localStorage.getItem('userToken')) {
      window.location.href = 'home.html';
    }

    document.getElementById('registerForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();
      const country = document.getElementById('country').value;
      const errorMessage = document.getElementById('error-message');
      errorMessage.style.display = 'none';

      try {
        const res = await fetch(`${API_BASE}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, country })
        });

        const data = await res.json();

        if (!res.ok) {
          errorMessage.textContent = data.error || '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏';
          errorMessage.style.display = 'block';
          return;
        }

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–∫–µ–Ω
        localStorage.setItem('userToken', data.token);

        // –ü—Ä–æ—Ñ–∏–ª—å
        const profileRes = await fetch(`${API_BASE}/api/user/profile`, {
          headers: { Authorization: `Bearer ${data.token}` }
        });

        if (profileRes.ok) {
          const profile = await profileRes.json();
          localStorage.setItem('userData', JSON.stringify(profile));
        } else {
          localStorage.setItem('userData', JSON.stringify({ email, country }));
        }

        // –ù–∞ –≥–ª–∞–≤–Ω—É—é
        window.location.href = 'home.html';

      } catch (err) {
        console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:', err);
        errorMessage.textContent = '–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
        errorMessage.style.display = 'block';
      }
    });
  </script>
  
  
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function () {
      navigator.serviceWorker.register('/sw.js').catch(function (err) {
        console.warn('SW registration failed:', err);
      });
    });
  }
</script>
  
</body>
</html>